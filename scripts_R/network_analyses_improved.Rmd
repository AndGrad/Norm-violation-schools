---
title: "Network Analyses"
---

```{r load-libraries, message=FALSE, warning=FALSE}
# Load required libraries for network analysis and plotting
library(igraph)       # Network analysis
library(ggplot2)      # Plotting
library(cowplot)      # Clean theme
library(patchwork)    # Combine plots
library(tidyr)        # Data reshaping

# Define and set a custom theme for all plots:
# Titles at 14pt, all other text at 10pt, based on cowplot
custom_theme <- theme_cowplot() +
  theme(
    plot.title = element_text(size = 14)
  )
theme_set(custom_theme)
```

# Data Preparation

```{r prepare-data}
# Convert network centrality measures into a data frame
# 'g' is assumed to be your igraph network object
in_deg    <- degree(g, mode = "in")
eigen_c   <- eigen_centrality(g, directed = TRUE)$vector
betw      <- betweenness(g, directed = TRUE)

df_metrics <- data.frame(
  in_degree   = in_deg,
  eigen_c     = eigen_c,
  betweenness = betw
)
```

# Plotting Function

```{r plotting-function}
# Create a reusable function to plot distributions of metrics
plot_metric <- function(data, metric, bins = 30, fill_color = "skyblue") {
  ggplot(data, aes_string(x = metric)) +
    geom_histogram(bins = bins, fill = fill_color, color = "white") +
    labs(
      title = paste0(gsub("_", " ", tools::toTitleCase(metric)), " Distribution"),
      x     = tools::toTitleCase(metric),
      y     = "Count"
    )
}
```

# Individual Metric Distributions

```{r plots-individual, fig.height=4, fig.width=6}
# Plot each metric separately for detailed inspection
p_in_deg <- plot_metric(df_metrics, "in_degree")
p_eigen  <- plot_metric(df_metrics, "eigen_c", fill_color = "salmon")
p_betw   <- plot_metric(df_metrics, "betweenness", fill_color = "lightgreen")

# Display the plots
p_in_deg
p_eigen
p_betw
```

# Combined Distribution Plot

```{r combined-plot, fig.height=5, fig.width=12}
# Arrange the individual plots side by side using patchwork
combined_plot <- (p_in_deg + p_eigen + p_betw) +
  plot_layout(ncol = 3, guides = "collect") &
  theme(
    axis.title = element_text(size = 10),
    axis.text  = element_text(size = 10)
  )

combined_plot + 
  plot_annotation(title = "Network Centrality Distributions (Combined)")
```

# Faceted Distribution Plot

```{r faceted-plot, fig.height=6, fig.width=6}
# Alternative view: single faceted histogram with free scales
df_long <- pivot_longer(
  df_metrics,
  cols = everything(),
  names_to = "metric",
  values_to = "value"
)

ggplot(df_long, aes(x = value, fill = metric)) +
  geom_histogram(bins = 30, color = "white") +
  facet_wrap(~ metric, scales = "free") +
  labs(
    title = "Network Centrality Distributions (Faceted)",
    x     = NULL,
    y     = "Count"
  ) +
  theme(legend.position = "none")
```
